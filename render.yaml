services:
  # PostgreSQL Database
  - type: pserv
    name: sentiment-postgres
    env: docker
    plan: free
    repo: https://github.com/Uttama786/Real-Time-Sentiment-Analysis.git
    region: oregon
    healthCheckPath: /
    envVars:
      - key: POSTGRES_DB
        value: sentiment_db
      - key: POSTGRES_USER
        value: postgres
      - key: POSTGRES_PASSWORD
        generateValue: true
      - key: POSTGRES_HOST_AUTH_METHOD
        value: trust

  # Redis Cache
  - type: redis
    name: sentiment-redis
    plan: free
    maxmemoryPolicy: allkeys-lru
    ipAllowList: []

  # Main FastAPI Application
  - type: web
    name: sentiment-api
    env: docker
    plan: free
    repo: https://github.com/Uttama786/Real-Time-Sentiment-Analysis.git
    region: oregon
    healthCheckPath: /docs
    dockerfilePath: ./Dockerfile
    dockerCommand: uvicorn app:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PORT
        value: 8000
      - key: DB_HOST
        fromService:
          type: pserv
          name: sentiment-postgres
          property: host
      - key: DB_PORT
        value: 5432
      - key: DB_NAME
        value: sentiment_db
      - key: DB_USER
        value: postgres
      - key: REDIS_HOST
        fromService:
          type: redis
          name: sentiment-redis
          property: host
      - key: REDIS_PORT
        value: 6379

  # Dashboard (Dash/Plotly)
  - type: web
    name: sentiment-dashboard
    env: docker
    plan: free
    repo: https://github.com/Uttama786/Real-Time-Sentiment-Analysis.git
    region: oregon
    healthCheckPath: /
    dockerfilePath: ./Dockerfile
    dockerCommand: python dashboard/app.py
    envVars:
      - key: PORT
        value: 8050
      - key: DB_HOST
        fromService:
          type: pserv
          name: sentiment-postgres
          property: host
      - key: DB_PORT
        value: 5432
      - key: DB_NAME
        value: sentiment_db
      - key: DB_USER
        value: postgres
      - key: REDIS_HOST
        fromService:
          type: redis
          name: sentiment-redis
          property: host
      - key: REDIS_PORT
        value: 6379
